<!doctype html>
<html lang="en">
<head>
  <title>Avaje</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro|Ubuntu&display=swap">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/site.css">
  <link rel="stylesheet" href="/css/pygments.css">
</head>
<body>

<div class="container">
  <aside id="sidenav">
    <nav class="side scroll">
<ul>
  <li><a href="#overview">Overview</a>
</li>
<li><a href="#quick-start">Quick-Start</a>
</li>
<li><a href="#jpms">Java Modules</a>
</li>
<li><a href="#generated">Generated Adapters</a>
</li>
<li><a href="#usage">Usage</a>
</li>
<li><a href="#dependencies">Dependencies</a>
    <ul>
      <li><a href="#maven">Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
</li>
<li><a href="#controllers">Controllers</a>
    <ul>
      <li><a href="#controller">@Controller</a></li>
      <li><a href="#path">@Path</a></li>
      <li><a href="#path-parameters">Path parameters</a></li>
      <li><a href="#matrix-parameters">Matrix parameters</a></li>
      <li><a href="#query-parameters">@QueryParam</a></li>
      <li><a href="#bean-param">@BeanParam</a></li>
      <li><a href="#post">Request Body</a></li>
      <li><a href="#form">@Form</a></li>
      <li><a href="#form-param">@FormParam</a></li>
      <li><a href="#form-beans">Form beans</a></li>
      <li><a href="#produces">@Produces</a></li>
      <li><a href="#header">@Header</a></li>
      <li><a href="#cookie">@Cookie</a></li>
      <li><a href="#default">@Default</a></li>
    </ul>
</li>
<li><a href="#filter">Filters/Exceptions</a>
    <ul>
      <li><a href="#filter">@Filter</a></li>
      <li><a href="#exceptions">@ExceptionHandler</a></li>
      <li><a href="#javalin-filter">@Before/@After</a></li>
    </ul>
</li>
<li><a href="#context">Context</a>
    <ul>
      <li><a href="#javalin-context">Javalin Context</a></li>
      <li><a href="#helidon-request">Helidon request</a></li>
      <li><a href="#helidon-request">Helidon response</a></li>
      <li><a href="#request-scoped">Request scope</a></li>
      <li><a href="#instrument-context">Instrumenting Context</a></li>
    </ul>
</li>
<li><a href="#type-conversions">Type conversions</a>
</li>
<li><a href="#bean-validation">Bean validation</a>
</li>
<li><a href="#roles">Roles</a>
    <ul>
      <li><a href="#roles-javalin">Javalin</a></li>
      <li><a href="#roles-jex">Jex</a></li>
    </ul>
</li>
<li><a href="#openapi">OpenAPI</a>
    <ul>
      <li><a href="#doc">Javadoc</a></li>
      <li><a href="#response">@OpenApiResponse</a></li>
      <li><a href="#validation">Validation Annotations</a></li>
      <li><a href="#swag">Swagger Annotations</a></li>
      <li><a href="#plug">Maven Plugin</a></li>
      <li><a href="#serve">Serving OpenApi</a></li>
    </ul>
</li>
<li><a href="#jaxrs">JAX-RS comparison</a>
</li>
</ul>
<p>&nbsp;</p>
    </nav>
  </aside>
  <article id="main-content">
    
<header>
  <nav id="top">
    <div class="breadcrumb">
      <a href="/" title="home">Avaje</a> &nbsp;&nbsp;/&nbsp;&nbsp;HTTP
    </div>
    <ul>
      <li><a href="/" title="home"><i class="fas fa-home"></i></a></li>
      <li><a href="https://discord.gg/Qcqf9R27BR" title="discord server"><i class="fab fa-discord"></i></a></li>
      <li><a href="https://github.com/avaje/avaje-http" title="github source"><i class="fab fa-github"></i></a></li>
      <li><a onclick="toggleTheme();" title="switch dark light theme"><i class="fas fa-adjust"></i></a></li>
    </ul>
  </nav>
</header>
<h1 id="overview">Avaje HTTP Server & Client</h1>
<p>
Library that generates extremely fast adapter code
for Javalin and Helidon SE/Nima APIs via Annotation Processing.
</p>
<table width="100%">
  <tr>
    <th>Discord</th>
    <th>Source</th>
    <th>API Docs</th>
    <th>Issues</th>
    <th>Releases</th>
  </tr>
  <tr>
    <td><a href="https://discord.gg/Qcqf9R27BR">Discord</td>
    <td><a target="_blank" href="https://github.com/avaje/avaje-http">Github</a></td>
    <td><a target="_blank" href="https://javadoc.io/doc/io.avaje/avaje-http-api">Javadoc</a></td>
    <td><a target="_blank" href="https://github.com/avaje/avaje-http/issues">Github</a></td>
    <td><a href="https://github.com/avaje/avaje-http/releases"><img src="https://img.shields.io/maven-central/v/io.avaje/avaje-http-api.svg?label=Maven%20Central"></a></td>
  </tr>
</table>
<p>&nbsp;</p>
<p>
 This library enables your service to be fast and light at runtime by using source code generation
  (java annotation processors) to adapt annotated rest controllers with (<code>@Path, @Get, @Post etc</code>)
  to <a target="_blank" href="https://javalin.io">Javalin</a>, <a target="_blank" href="https://helidon.io">Helidon SE</a>
  and similar web routing http servers.
</p>
<p>
  Effectively we are replacing Jersey or RestEasy with source code generation and the capabilities
  of <a target="_blank" href="https://javalin.io">Javalin</a> or <a target="_blank" href="https://helidon.io">Helidon SE</a>
  (web routing).
</p>
<p>
 The generated source code is very simple and readable, so developers can navigate to it and add break points and debug just as if we wrote it all
  manually ourselves.
</p>
<p>
  What we <b>lose</b> in doing this is automatic
  <a target="_blank" href="https://en.wikipedia.org/wiki/Content_negotiation">Content negotiation</a>. For example, if
  we need endpoints that serve response content as <i>either</i> JSON or XML content based on request headers
  then we would need to handle this ourselves.
</p>

<h4>Summary</h4>
<ul>
  <li>Provides a similar programming style to JAX-RS and Spring MVC</li>
  <li>Light weight by using code generation - no reflection, no extra overhead</li>
  <li>Automatically generates <a href="#openapi">Swagger/OpenAPI</a> documentation</li>
  <li>Allows use of underlying Javalin/Helidon request/response constructs as needed</li>
  <li>Supports request scope injection of Javalin Context, Helidon request and response</li>
  <li>Supports using <a href="#bean-validation">Bean validation</a> on request payloads</li>
  <li>Requires Fewer annotations than typical JAX-RS - avoid annotation overload</li>
</ul>

<h4>JAX-RS Annotations</h4>
<p>
  As we are using Java annotation processing our generators are exposed to more information
  than is obtained via reflection at runtime. This means we can reduce annotation verbosity
  making nicer cleaner API's.
</p>
<p>
  A design decision has been to not use JAX-RS annotations. This is because
  the JAX-RS annotations are a lot more verbose than we desire and because they are not provided
  as a nice clean separate dependency. The JAX-RS API has a lot of extra weight that we do not need.
</p>

<h2>HTTP Client</h2>
<p>
  Avaje <a href="/http-client/">http client</a> is a lightweight wrapper of JDK HttpClient
  that also supports Client API with annotation processing to generate source code that implements
  the API.
</p>

<h2 id="quick-start">Quick Start</h2>
<p>
  1. Add <em>avaje-http-api</em> dependency.
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-http-api<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>&#36;{avaje-http.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>

<p>
2. Add the generator module for your desired microframework as a annotation processor.
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Annotation processors --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-http-{helidon/javalin}-generator<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>&#36;{avaje-http.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>


<p>3. Define a Controller (These APT processors work with both Java and Kotlin.)</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.example.hello</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.avaje.http.api.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.avaje.http.api.Get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.avaje.http.api.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/widgets&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WidgetController</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloComponent</span> <span class="n">hello</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">WidgetController</span><span class="o">(</span><span class="n">HelloComponent</span> <span class="n">hello</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hello</span> <span class="o">=</span> <span class="n">hello</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Widget</span> <span class="nf">getById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Widget</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">&quot;you got it&quot;</span><span class="o">+</span> <span class="n">hello</span><span class="o">.</span><span class="na">hello</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">()</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">new</span> <span class="n">Widget</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Rob&quot;</span><span class="o">),</span> <span class="k">new</span> <span class="n">Widget</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">&quot;Fi&quot;</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="n">record</span> <span class="nf">Widget</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">){};</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="jpms">Java Module Setup</h2>
<p>
  In the <code>module-info.java</code> we need to define the avaje modules:
</p>
<h5>Example module-info</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">org</span><span class="o">.</span><span class="na">example</span> <span class="o">{</span>

  <span class="n">requires</span> <span class="n">io</span><span class="o">.</span><span class="na field">avaje</span><span class="o">.</span><span class="na field">http</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>
  <span class="c1">// if using javalin specific actions like @Before/@After</span>
  <span class="c1">//requires static io.avaje.http.api.javalin;</span>

<span class="o">}</span>
</pre></div>
</div>

<h2 id="generated">Generated Adapter</h2>
<p>Given the above controller and the corresponding framework generator, the below class will be generated</p>

<details>
    <summary>Helidon 4.x</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;avaje-helidon-generator&quot;</span><span class="o">)</span>
<span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WidgetController&#36;Route</span> <span class="kd">implements</span> <span class="n">HttpFeature</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">WidgetController</span> <span class="n">controller</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">WidgetController&#36;Route</span><span class="o">(</span><span class="n">WidgetController</span> <span class="n">controller</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">controller</span> <span class="o">=</span> <span class="n">controller</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">(</span><span class="n">HttpRouting</span><span class="o">.</span><span class="na">Builder</span> <span class="n">routing</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">routing</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets/{id}&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">_getById</span><span class="o">);</span>
    <span class="n">routing</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">_getAll</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_getById</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">res</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">OK_200</span><span class="o">);</span>
    <span class="k">var</span> <span class="n">pathParams</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">pathParameters</span><span class="o">();</span>
    <span class="k">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">asInt</span><span class="o">(</span><span class="n">pathParams</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">());</span>
    <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">res</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_getAll</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">res</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">OK_200</span><span class="o">);</span>
    <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
    <span class="n">res</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</details>

<details>
  <summary>Javalin</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;avaje-javalin-generator&quot;</span><span class="o">)</span>
<span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WidgetController&#36;Route</span> <span class="kd">implements</span> <span class="n">Plugin</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">WidgetController</span> <span class="n">controller</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">WidgetController&#36;Route</span><span class="o">(</span><span class="n">WidgetController</span> <span class="n">controller</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">controller</span> <span class="o">=</span> <span class="n">controller</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Javalin</span> <span class="n">app</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets/{id}&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
      <span class="k">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">asInt</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">));</span>
      <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">});</span>

    <span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
      <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</details>

<details>
    <summary>Helidon 4.x (Avaje-Jsonb on classpath)</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;avaje-helidon-generator&quot;</span><span class="o">)</span>
<span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WidgetController&#36;Route</span> <span class="kd">implements</span> <span class="n">HttpFeature</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">WidgetController</span> <span class="n">controller</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonType</span><span class="o">&lt;</span><span class="n">WidgetController</span><span class="o">.</span><span class="na">Widget</span><span class="o">&gt;</span> <span class="n">widgetController&#36;WidgetJsonType</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">WidgetController</span><span class="o">.</span><span class="na">Widget</span><span class="o">&gt;&gt;</span> <span class="n">listWidgetController&#36;WidgetJsonType</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">WidgetController&#36;Route</span><span class="o">(</span><span class="n">WidgetController</span> <span class="n">controller</span><span class="o">,</span> <span class="n">Jsonb</span> <span class="n">jsonb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">controller</span> <span class="o">=</span> <span class="n">controller</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">widgetController&#36;WidgetJsonType</span> <span class="o">=</span> <span class="n">jsonb</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">WidgetController</span><span class="o">.</span><span class="na field">Widget</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">listWidgetController&#36;WidgetJsonType</span> <span class="o">=</span> <span class="n">jsonb</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">WidgetController</span><span class="o">.</span><span class="na field">Widget</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">(</span><span class="n">HttpRouting</span><span class="o">.</span><span class="na">Builder</span> <span class="n">routing</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">routing</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets/{id}&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">_getById</span><span class="o">);</span>
    <span class="n">routing</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">_getAll</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_getById</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">res</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">OK_200</span><span class="o">);</span>
    <span class="k">var</span> <span class="n">pathParams</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">pathParameters</span><span class="o">();</span>
    <span class="k">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">asInt</span><span class="o">(</span><span class="n">pathParams</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">());</span>
    <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">res</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaTypes</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">);</span>
    <span class="c1">//jsonb has a special accommodation for helidon to improve performance</span>
    <span class="n">widgetController&#36;WidgetJsonType</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">JsonOutput</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">res</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">_getAll</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">res</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">OK_200</span><span class="o">);</span>
    <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
    <span class="n">res</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaTypes</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">);</span>
    <span class="n">listWidgetController&#36;WidgetJsonType</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">JsonOutput</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">res</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</details>

<details>
  <summary>Javalin (Avaje-Jsonb on classpath)</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;avaje-javalin-generator&quot;</span><span class="o">)</span>
<span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WidgetController&#36;Route</span> <span class="kd">implements</span> <span class="n">Plugin</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">WidgetController</span> <span class="n">controller</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;&gt;</span> <span class="n">listWidgetJsonType</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonType</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">widgetJsonType</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">WidgetController&#36;Route</span><span class="o">(</span><span class="n">WidgetController</span> <span class="n">controller</span><span class="o">,</span> <span class="n">Jsonb</span> <span class="n">jsonB</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">controller</span> <span class="o">=</span> <span class="n">controller</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">listWidgetJsonType</span> <span class="o">=</span> <span class="n">jsonB</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">Widget</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">widgetJsonType</span> <span class="o">=</span> <span class="n">jsonB</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">Widget</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Javalin</span> <span class="n">app</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets/{id}&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
      <span class="k">var</span> <span class="n">id</span> <span class="o">=</span> <span class="n">asInt</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">));</span>
      <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="n">widgetJsonType</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">).</span><span class="na">outputStream</span><span class="o">());</span>
    <span class="o">});</span>

    <span class="n">app</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/widgets&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
      <span class="k">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
      <span class="n">listWidgetJsonType</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">).</span><span class="na">outputStream</span><span class="o">());</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</details>

<h2 id=usage>Usage</h2>
<p>
  The natural way to use the generated adapters is to
  get a DI library to find and wire them.
</p>
<p>
  Note that there isn't a requirement to use Avaje for dependency injection.
  Any DI library that can find and wire the generated <em>@Singleton</em> beans can
  be used.
</p>

<h4>Usage with Javalin</h4>

<p>The annotation processor will generate controller classes implementing the javalin <code>Plugin</code> interface, which means we can register them using:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Plugin</span><span class="o">&gt;</span> <span class="n">routes</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">//retrieve using a DI framework</span>

<span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cfg</span> <span class="o">-&gt;</span> <span class="n">routes</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">plugins</span><span class="o">::</span><span class="n">register</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</pre></div>
</div>

<h4>Usage with Helidon SE (4.x)</h2>
<p>
The annotation processor will generate controller classes implementing the Helidon <code>HttpFeature</code> interface, which we can register with the Helidon <code>HttpRouting</code>.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">HttpFeature</span><span class="o">&gt;</span> <span class="n">routes</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">//retrieve using a DI framework</span>
<span class="kd">final</span> <span class="k">var</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">HttpRouting</span><span class="o">.</span><span class="na">builder</span><span class="o">();</span>

<span class="n">routes</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">builder</span><span class="o">::</span><span class="n">addFeature</span><span class="o">);</span>

<span class="n">WebServer</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
         <span class="o">.</span><span class="na">addRouting</span><span class="o">(</span><span class="n">builder</span><span class="o">)</span>
         <span class="o">.</span><span class="na">build</span><span class="o">()</span>
         <span class="o">.</span><span class="na">start</span><span class="o">();</span>
</pre></div>
</div>

<h2 id="dependencies">Dependencies</h2>

<h3 id="maven">Maven</h3>
<p>
  See the <a href="#quick-start">quick start example </a>
</p>

<h3 id="gradle">Gradle</h3>
<p>
  See the example at:
  <a target="_blank" href="https://github.com/dinject/examples/blob/master/javalin-gradle-java-basic/build.gradle">examples/javalin-gradle-java-basic/build.gradle</a>
</p>
<p>
  Use Gradle version 5.2 or greater which has better support for annotation processing.
</p>
<p>
  Also review the IntelliJ IDEA Gradle settings - see below.
</p>

<h3>Optional: OpenAPI plugin</h3>
<p>
  Optionally add the <code>io.avaje.openapi</code> plugin to have the openapi.json
  (swagger) to be generated into <em>src/main/resources/public</em>.
</p>

<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">id</span><span class="o">(</span><span class="s1">&#39;io.avaje.openapi&#39;</span><span class="o">)</span> <span class="n">version</span><span class="o">(</span><span class="s1">&#39;1.2&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>

<h3>Dependencies</h3>
<p>
  Add <em>avaje-inject</em> and <em>avaje-http-api</em> as compile dependencies.<br/>
  Add <em>avaje-http-javalin-generator</em> and <em>javalin-generator</em> as annotation processors.
</p>

<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">compile</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-inject:8.10&#39;</span><span class="o">)</span>
  <span class="n">compile</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-http-api:1.20&#39;</span><span class="o">)</span>

  <span class="n">annotationProcessor</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-inject-generator:8.10&#39;</span><span class="o">)</span>
  <span class="n">annotationProcessor</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-http-javalin-generator:1.20&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>


<h4>Kotlin KAPT</h4>
<p>
  For use with Kotlin we change the <em>annotationProcessor</em> to be <code>kapt</code> for the Kotlin compiler.
</p>
<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">kapt</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-inject-generator:8.10&#39;</span><span class="o">)</span>
  <span class="n">kapt</span><span class="o">(</span><span class="s1">&#39;io.avaje:avaje-http-javalin-generator:1.20&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>

<h3>OpenAPI Plugin configuration</h3>
<p>
  We can change the location of the generated openapi file by adding an <code>openapi</code> configuration
  section in build.gradle.
</p>
<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">openapi</span> <span class="o">{</span>
  <span class="n">destination</span> <span class="o">=</span> <span class="s1">&#39;other/my-api.json&#39;</span>
<span class="o">}</span>
</pre></div>
</div>

<h3 id="idea">IntelliJ IDEA with Gradle</h3>
<p>
  We want to delegate the <code>build</code> to Gradle (to properly include the annotation processing)
  so check our IDEA settings.
</p>

<h4>Settings / Build / Compiler / Annotation processors</h4>
<p>
  Ensure that <code>Enable annotation processing</code> is disabled so
  that the build is delegated to Gradle (including the annotation processing):
</p>

<img src="/images/gradle-idea-disable-apt.png" width="100%">

<h4>Settings / Build / Build tools / Gradle</h4>
<p>
  Make sure <code>Build and run</code> is delegated to Gradle.
</p>
<p>
  Optionally set <em>Run tests using</em> to <code>Gradle</code> but leaving it to IntelliJ IDEA should be ok.
</p>

<img src="/images/gradle-idea-build.png" width="100%">


<h2 id="controllers">Controllers</h2>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/contacts&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">ContactController</span> <span class="o">{</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Contact</span> <span class="nf">getById</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Post</span>
  <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Contact</span> <span class="n">contact</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Delete</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">deleteById</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h3 id="controller">@Controller</h3>
<p>
  Create controllers <code>@Controller</code>.
  You can provide a path segment that is prepended
  to any path segments defined by on methods using <code>@Get</code>,
  <code>@Post</code>, <code>@Put</code> etc. There are three ways to prepend a path.
</p>

<h4>1. Directly put the path in the controller annotation.</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span><span class="o">(</span><span class="s">&quot;/customers&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">CustomerController</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<h4>2. Use <code>@Path</code> and <code>@Controller</code></h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/customers&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">CustomerController</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>3. Use <code>@Path</code> on an Interface and <code>@Controller</code> on an implementing class</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/customers&quot;</span><span class="o">)</span>
<span class="kd">interface</span> <span class="nc">CustomerController</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="kd">class</span> <span class="nc">CustomerControllerImpl</span> <span class="kd">implements</span> <span class="n">CustomerController</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<p>
 Web Methods on a controller are annotated with HTTP annotations like <code>@Get</code>,
  <code>@Post</code>, <code>@Put</code>, <code>@Delete</code>.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span><span class="o">(</span><span class="s">&quot;/contacts&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">ContactController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ContactService</span> <span class="n">contactService</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="n">ContactController</span><span class="o">(</span><span class="n">ContactService</span> <span class="n">contactService</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">contactService</span> <span class="o">=</span> <span class="n">contactService</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Contact</span> <span class="nf">getById</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/find/{type}&quot;</span><span class="o">)</span>
  <span class="nx">List</span><span class="o">&lt;</span><span class="nx">Contact</span><span class="o">&gt;</span> <span class="nf">findByType</span><span class="o">(</span><span class="nx">String</span> <span class="nx">type</span><span class="o">,</span> <span class="nd">@QueryParam</span> <span class="nx">String</span> <span class="nx">lastName</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Post</span>
  <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Contact</span> <span class="n">contact</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The controllers can have dependencies injected. The ContactController above can easily
  have the ContactService dependency injected by <a href="/inject">avaje-inject</a>.
</p>

<h3 id="controller-singleton">Controllers are singleton scoped by default</h3>
<p>
  By default controllers are singleton scoped. If the controllers have a dependency
  on Javalin context, Helidon ServerRequest or ServerResponse then they automatically
  become <a href="#request-scoped">request scoped</a>.
</p>

<h2 id="path">@Path</h2>
<p>
  <code>@Path</code> is put on the controller class. The path is prepended to the paths
  specified by <code>@Get</code>, <code>@Post</code> etc.
</p>
<p>
  <code>@Path("/")</code> is used for the root context path.
</p>

<h5>Example</h5>
<p>
  The URI's for the RootController below would be:
</p>
<div class="syntax text"><div class="highlight"><pre><span></span>GET /
GET /foo
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">RootController</span> <span class="o">{</span>

  <span class="nd">@Get</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nx">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello world&quot;</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nx">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">helloFoo</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello Foo&quot;</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>

<p>
  The URI's for the CustomerController below are:
</p>
<div class="syntax text"><div class="highlight"><pre><span></span>GET /customer
GET /customer/active
GET /customer/active/{customerType}
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/customer&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">CustomerController</span> <span class="o">{</span>

  <span class="nd">@Get</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/active&quot;</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">findActive</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/active/{customerType}&quot;</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">findByType</span><span class="o">(</span><span class="n">String</span> <span class="n">customerType</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<h3>Module/Package Wide Root Paths</h3>
<p>
  When a <code>@Path</code> annotation is placed on a module-info or package-info file, that path wil be prepended to all controllers contained within the packages and sub-packages.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/module&quot;</span><span class="o">)</span>
<span class="n">module</span> <span class="n">example</span><span class="o">.</span><span class="na">module</span> <span class="o">{</span>
<span class="c1">//contents...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The URI's for the CustomerController below are:
</p>
<div class="syntax text"><div class="highlight"><pre><span></span>GET /module/customer
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span><span class="o">(</span><span class="s">&quot;/customer&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">CustomerController</span> <span class="o">{</span>

  <span class="nd">@Get</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="path-parameters">Path parameters</h2>
<p>
  Path parameters start with <code>{</code> and end with <code>}</code>.
</p>
<p>
  For example <code>{id}</code>, <code>{name}</code>, <code>{startDate}</code>.
</p>
<p>
  The path parameter names need to be matched by method parameter names on
  the controller. For example:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}/{startDate}/{type}&quot;</span><span class="o">)</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Bazz</span><span class="o">&gt;</span> <span class="nf">findBazz</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">,</span> <span class="n">LocalDate</span> <span class="n">startDate</span><span class="o">,</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="c1">// id, startDate, type all match method parameter names</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  This means that unlike JAX-RS we do not need a <code>@PathParam</code> annotation
  and this makes our code less verbose and nicer to read.
</p>

<p>
  Note that the JAX-RS equivalent to the above is below. The method declaration starts
  to get long and harder to read quite quickly.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// JAX-RS &quot;annotation noise&quot; with @PathParam</span>

<span class="nd">@GET</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/{id}/{startDate}/{sort}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Bazz</span><span class="o">&gt;</span> <span class="nf">findBazz</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="kt">long</span> <span class="nx">id</span><span class="o">,</span> <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;startDate&quot;</span><span class="o">)</span> <span class="nx">LocalDate</span> <span class="nx">startDate</span><span class="o">,</span> <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;sort&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">sort</span><span class="o">)</span> <span class="o">{</span>

  <span class="c1">// we start getting &quot;annotation noise&quot; ...</span>
  <span class="c1">// making the code hard to read</span>

<span class="o">}</span>
</pre></div>
</div>


<h2 id="matrix-parameters">Matrix parameters</h2>
<p>
  Matrix parameters are optional sub-parameters that relate to a specific segment of the path.
  They are effectively an alternative to using query parameters where we have optional parameters
  that relate to a specific path segment.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// &#39;type&#39; path segment has matrix parameters &#39;category&#39; and &#39;vendor&#39;</span>

<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/products/{type;category;vendor}/available&quot;</span><span class="o">)</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">products</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">category</span><span class="o">,</span> <span class="n">String</span> <span class="n">vendor</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax text"><div class="highlight"><pre><span></span>// example URI&#39;s

GET /products/chair/available
GET /products/chair;category=kitchen/available
GET /products/chair;category=kitchen;vendor=jfk/available
</pre></div>
</div>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// &#39;type&#39; has matrix parameters &#39;category&#39; and &#39;vendor&#39;</span>
<span class="c1">// &#39;range&#39; has matrix parameter &#39;style&#39;</span>

<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/products/{type;category;vendor}/{range;style}&quot;</span><span class="o">)</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">products</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">category</span><span class="o">,</span> <span class="n">String</span> <span class="n">vendor</span><span class="o">,</span> <span class="n">String</span> <span class="n">range</span><span class="o">,</span> <span class="n">String</span> <span class="n">style</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax text"><div class="highlight"><pre><span></span>// example URI&#39;s

GET /products/chair/commercial
GET /products/chair;category=kitchen/domestic
GET /products/chair;category=kitchen/commercial;style=contemporary
GET /products/chair/commercial;style=classical
</pre></div>
</div>

<h4>JAX-RS @MatrixParam</h4>
<p>
  Our matrix parameters are equivalent to JAX-RS except that they relate by convention to
  method parameters of the same name and we do not need explicit <code>@MatrixParam</code>.
</p>
<p>
  The JAX-RS equivalent to the above is below. The method declaration starts
  to get long and harder to read quite quickly.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// JAX-RS &quot;annotation noise&quot; with @MatrixParam and @PathParam</span>

<span class="nd">@GET</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/products/{type;category;vendor}/{range;style}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Product</span><span class="o">&gt;</span> <span class="nf">products</span><span class="o">(</span><span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">type</span><span class="o">,</span> <span class="nd">@MatrixParam</span><span class="o">(</span><span class="s">&quot;category&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">category</span><span class="o">,</span> <span class="nd">@MatrixParam</span><span class="o">(</span><span class="s">&quot;vendor&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">vendor</span><span class="o">,</span> <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">range</span><span class="o">,</span> <span class="nd">@MatrixParam</span><span class="o">(</span><span class="s">&quot;style&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">style</span><span class="o">)</span> <span class="o">{</span>

  <span class="c1">// we start getting &quot;annotation noise&quot; ...</span>
  <span class="c1">// making the code hard to read</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="query-parameters">@QueryParam</h2>
<p>
  We explicitly specify query parameters using <code>@QueryParam</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// Explicit query parameter order-by</span>

<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{bornAfter}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nx">LocalDate</span> <span class="nx">bornAfter</span><span class="o">,</span> <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;order-by&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">orderBy</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h3>Implied query parameters</h3>
<p>
  Query parameters can be <em>implied</em> by not being a path parameter.
  That is, if a method parameter does not match a path parameter then it is
  implied to be a query parameter.
</p>
<p>
  The following 3 declarations are exactly the same with all 3 having
  a query parameters for <code>orderBy</code>
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{bornAfter}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nx">LocalDate</span> <span class="nx">bornAfter</span><span class="o">,</span> <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;orderBy&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">orderBy</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{bornAfter}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nx">LocalDate</span> <span class="nx">bornAfter</span><span class="o">,</span> <span class="nd">@QueryParam</span> <span class="nx">String</span> <span class="nx">orderBy</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{bornAfter}&quot;</span><span class="o">)</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="n">LocalDate</span> <span class="n">bornAfter</span><span class="o">,</span> <span class="n">String</span> <span class="n">orderBy</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// orderBy implied as query parameter</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<p>
  Note that we must explicitly use <code>@QueryParam</code> when the query parameter
  is not a valid java identifier. For example, if the query parameter includes a hyphen
  then we must use <code>@QueryParam</code> explicitly.
</p>

<h4>Example</h4>
<p>
  We must use an explicit <code>@QueryParam</code> when the parameter name includes a
  hyphen like <code>order-by</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// order-by is not a valid java identifier</span>
<span class="c1">// ... so we must use explicit @QueryParam here</span>

<span class="nd">@Get</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;order-by&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">orderBy</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h3>Query parameter types</h3>
<p>
  Query parameters can be one of the following types:
  <em>String, Integer, Long, Short, Float, Double, Boolean, BigDecimal, UUID, LocalDate, LocalTime, LocalDateTime, or Enums</em>(Will use <code>Enum.valueOf(EnumType, parameter)</code> ).
  To get multivalue parameters we can use <code>List&ltT&gt</code> or <code>Set&ltT&gt</code> where <code>T</code> is any of the previously mentioned types.
  To get all query parameters define a parameter of type <code>Map&ltList&ltT&gt&gt</code>.
</p>
<p>
  Query parameters are considered optional / nullable.
</p>
<h2 id="bean-param">@BeanParam</h2>
<p>
  We can create a bean and annotate it in a controller method with <code>@BeanParam</code>.
  The properties on the bean default to being <code>query parameters</code>.
</p>
<p>
  We typically do this when we have a set of query parameters/headers that are
  common / shared across a number of endpoints.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonParams</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">Long</span> <span class="n">firstRow</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">maxRows</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">sortBy</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">filter</span><span class="o">;</span>
  <span class="c1">//you can use ignore to mark a field as not a request parameter</span>
  <span class="nd">@Ignore</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">ignored</span><span class="o">;</span>

  <span class="c1">//getters/setters or a constructor</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  We annotate the bean with <code>@BeanParam</code>
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;search/{type}&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nx">String</span> <span class="nx">type</span><span class="o">,</span> <span class="nd">@BeanParam</span> <span class="nx">CommonParams</span> <span class="nx">params</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The generated Javalin code for the above is:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/cats/search/{type}&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">);</span>
  <span class="n">CommonParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonParams</span><span class="o">();</span>
  <span class="n">params</span><span class="o">.</span><span class="na">setFirstRow</span><span class="o">(</span><span class="n">toLong</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;firstRow&quot;</span><span class="o">)));</span>
  <span class="n">params</span><span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="n">toLong</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;maxRows&quot;</span><span class="o">)));</span>
  <span class="n">params</span><span class="o">.</span><span class="na">setSortBy</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;sortBy&quot;</span><span class="o">));</span>
  <span class="n">params</span><span class="o">.</span><span class="na">setfilter</span><span class="o">(</span><span class="n">list</span><span class="o">(</span><span class="n">Objects</span><span class="o">::</span><span class="n">toString</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">&quot;filter&quot;</span><span class="o">)));</span>

  <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">controller</span><span class="o">.</span><span class="na">findCats</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">params</span><span class="o">));</span>
<span class="o">});</span>
</pre></div>
</div>
<h4>@Form</h4>
<p>
  <em>@BeanParam</em> and <em>@Form</em> are very similar except with <em>@Form</em> beans the
  properties default to form parameters instead of query parameters.
</p>

<h4>JAX-RS @BeanParam</h4>
<p>
  Our <em>@BeanParam</em> is virtually the same as JAX-RS <em>@BeanParam</em> except the properties
  default to being query parameters, whereas with JAX-RS we need to annotate each of the properties.
  We can do this because we have <em>@Form</em> and "Form beans".
</p>

<h4>BeanParam beans with @Header, @Cookie properties</h4>
<p>
  The properties on a "bean" default to being query parameters. We put <em>@Header</em> or
  <em>@Cookie</em> on properties that are instead headers or cookies.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonParams</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">Long</span> <span class="n">firstRow</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">maxRows</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">sortBy</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">filter</span>

  <span class="nd">@Header</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">ifModifiedSince</span><span class="o">;</span>

  <span class="nd">@Cookie</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">myState</span><span class="o">;</span>

  <span class="c1">//getters/setters or a constructor</span>
<span class="o">}</span>
</pre></div>
</div>
<h2 id="post">Request Body</h2>
<p>
  Avaje auto detects that a parameter is a request body if the type is a <code>POJO</code>/<code>byte[]</code>/<code>InputStream</code> and not marked with a <code>@BeanParam</code> annotation. To mark a string parameter as a body, use the <code>@BodyString</code> annotation.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Post</span>
<span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Generated for Javalin</h4>
<p>
  The code generated code for Javalin for save() above is:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/customers&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">bodyStreamAsClass</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>

<h2 id="form">@Form</h2>
<p>
  If a method has both <code>@Post</code> and <code>@Form</code> then the
  method parameters default to be form parameters.
</p>
<p>
  In the following example name, email and url all default to be form parameters.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Form</span> <span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;register&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="form-param">@FormParam</h2>
<p>
  For the example above we could alternatively use explicit <code>@FormParam</code>
  on each of the form parameters rather than <code>@Form</code>. We then get:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;register&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="nd">@FormParam</span> <span class="nx">String</span> <span class="nx">name</span><span class="o">,</span> <span class="nd">@FormParam</span> <span class="nx">String</span> <span class="nx">email</span><span class="o">,</span> <span class="nd">@FormParam</span> <span class="nx">String</span> <span class="nx">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The expectation is that we most often would use <code>@Form</code> because it reduces
  "annotation noise" and that we will very rarely use <code>@FormParam</code>. Potentially
  we only use @FormParam if the parameter name includes hyphen or similar characters that
  are not valid Java/Kotlin identifiers.
</p>


<h4>Generated for Javalin</h4>
<p>
  The generated Javalin code for both cases above is the same:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/customers/register&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">);</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">email</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>

<h3>@Default</h3>
<p>
  We can use <code>@Default</code> to specify a default value for form parameters.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Form</span> <span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;register&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="nx">String</span> <span class="nx">name</span><span class="o">,</span> <span class="nx">String</span> <span class="nx">email</span><span class="o">,</span> <span class="nd">@Default</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="form-beans">@Form "Form Beans"</h2>
<p>
  In the case where we are posting a form with a lot of parameters we can define a bean with
  properties for each of the form parameters rather than have a method with lots of arguments.
</p>
<p>
  "Form beans" can have a constructor with arguments. They do not require a no-arg constructor.
</p>
<p>
  Using a form bean can make the code nicer and gives us a nicer option to
  use validation annotations on the "form bean" properties.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyForm</span> <span class="o">{</span>

  <span class="nd">@Size</span><span class="o">(</span><span class="nx">min</span><span class="o">=</span><span class="mi">2</span><span class="o">,</span> <span class="nx">max</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
  <span class="c1">//getters/setters/constructors</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Form</span>
<span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;register&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">MyForm</span> <span class="n">myForm</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
The generated Javalin code for the above is.
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/contacts/register&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">MyForm</span> <span class="n">myForm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyForm</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">),</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">),</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">));</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">myForm</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>
<p>
  "Form beans" are nice with forms with lots of properties because they de-clutter our code
  and the generated code takes care of putting the values into our bean properties so that
  we don't have to write that code.
</p>
<p>
  This use of <em>@Form</em> is very similar to JAX-RS <em>@BeanParam</em> except that the
  bean properties default be being form parameters. With JAX-RS we would put a <code>@FormParam</code>
  on every property that is a form parameter which becomes a lot of annotation noise on a large form.
</p>

<h3 id="kotlin-data">Kotlin data class</h3>
<p>
  Kotlin data classes are a natural fit for form beans.
</p>
<div class="syntax kotlin"><div class="highlight"><pre><span></span><span class="k">data</span> <span class="k">class</span> <span class="nc">SaveForm</span><span class="p">(</span><span class="k">var</span> <span class="py">id</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="k">var</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="k">var</span> <span class="py">someDate</span><span class="p">:</span> <span class="n">LocalDate</span><span class="p">?)</span>


<span class="nd">@Form</span> <span class="nd">@Post</span>
<span class="k">fun</span> <span class="nf">saveIt</span><span class="p">(</span><span class="n">form</span><span class="p">:</span> <span class="n">SaveForm</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>
  The generated code for the above controller method is:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">SaveForm</span> <span class="n">form</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">SaveForm</span><span class="o">(</span>
    <span class="n">asLong</span><span class="o">(</span><span class="n">checkNull</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">),</span> <span class="s">&quot;id&quot;</span><span class="o">)),</span>     <span class="c1">// non-nullable type</span>
    <span class="n">checkNull</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">),</span> <span class="s">&quot;name&quot;</span><span class="o">),</span>         <span class="c1">// non-nullable type</span>
    <span class="n">toLocalDate</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;someDate&quot;</span><span class="o">))</span>
  <span class="o">);</span>

  <span class="n">controller</span><span class="o">.</span><span class="na">saveIt</span><span class="o">(</span><span class="n">form</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>

<p>
  If the form bean has Kotlin non-nullable types (id and name above) then the
  generated code includes a null check when populating the bean (the <em>checkNull()</em> method).
</p>
<p>
  If there is not a value for a non-nullable Kotlin property then a validation
  error will be thrown at that point (this validation exception is thrown relatively
  early compared to using bean validation on Java form beans).
</p>



<h3>Form beans with @QueryParam, @Header, @Cookie properties</h3>
<p>
  The properties on a "form bean" default to being form parameters. We put <em>@QueryParam</em>,
  <em>@Header</em> or <em>@Cookie</em> on properties that are instead query params, headers or cookies.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyForm</span> <span class="o">{</span>

  <span class="nd">@Size</span><span class="o">(</span><span class="nx">min</span><span class="o">=</span><span class="mi">2</span><span class="o">,</span> <span class="nx">max</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">url</span><span class="o">;</span>

  <span class="nd">@QueryParam</span>
  <span class="kd">public</span> <span class="n">Boolean</span> <span class="n">overrideFlag</span><span class="o">;</span>

  <span class="nd">@Header</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">ifModifiedSince</span><span class="o">;</span>

  <span class="nd">@Cookie</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">myState</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The generated code populates <em></em> from query params, headers and cookies. The generated code is:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/contacts/register&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">MyForm</span> <span class="n">myForm</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">MyForm</span><span class="o">();</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">);</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">);</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">url</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">);</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">overrideFlag</span> <span class="o">=</span> <span class="n">toBoolean</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;overrideFlag&quot;</span><span class="o">));</span>     <span class="c1">// queryParam !!</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">ifModifiedSince</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;If-Modified-Since&quot;</span><span class="o">);</span>            <span class="c1">// header !!</span>
  <span class="n">myForm</span><span class="o">.</span><span class="na">myState</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">cookie</span><span class="o">(</span><span class="s">&quot;myState&quot;</span><span class="o">);</span>                              <span class="c1">// cookie !!</span>

  <span class="n">controller</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">myForm</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>
<h2 id="produces">@Produces</h2>
<p>
  Use <code>@Produces</code> to modify the response content type and generated OpenAPI definition.
  When not specified, we default to <code>application/json</code>. We can set the default http status code for the method as well.
  If not specified, the default status codes for the different http verbs are as follows:<br>
  <code>GET(200)</code> <br>
  <code>POST(201)</code> <br>
  <code>PUT(200, void methods 204)</code> <br>
  <code>PATCH(200, void methods 204)</code> <br>
  <code>DELETE(200, void methods 204)</code>

</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
<span class="nd">@Controller</span>
<span class="kd">class</span> <span class="nc">RootController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">Service</span> <span class="n">service</span><span class="o">;</span>

  <span class="c1">//send plain text</span>
  <span class="nd">@Get</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nx">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">hello</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello world&quot;</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// default json</span>
  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;obj&quot;</span><span class="o">)</span>
  <span class="n">Example</span> <span class="nf">helloObj</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Example</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="c1">// we can also send our data as a byte array</span>
  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;png&quot;</span><span class="o">)</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nx">MediaType</span><span class="o">.</span><span class="na">IMAGE_PNG</span><span class="o">)</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">helloByte</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getPNG</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="c1">// use Javalin Context for our response</span>
  <span class="c1">// in this case Produces is only needed for the OpenAPI generation</span>
  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;ctx&quot;</span><span class="o">)</span>
  <span class="nd">@Produces</span><span class="o">(</span><span class="nx">MediaType</span><span class="o">.</span><span class="na">IMAGE_PNG</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">helloCTX</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">service</span><span class="o">.</span><span class="na">writeResponseDirectly</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">outputStream</span><span class="o">());</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>

<h2 id="header">@Header</h2>
<p>
  Use <code>@Header</code> for a header parameter.
  It the header parameter name is not explicitly specified then
  it is the <em>init caps snake case</em> of the parameter name.
</p>

<p>
  <code>userAgent</code> -> <code>User-Agent</code>
</p>
<p>
  <code>lastModified</code> -> <code>Last-Modified</code>
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Post</span>
<span class="nx">Bar</span> <span class="nf">postIt</span><span class="o">(</span><span class="nx">Foo</span> <span class="nx">payload</span><span class="o">,</span> <span class="nd">@Header</span><span class="o">(</span><span class="s">&quot;User-Agent&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">userAgent</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// explicit</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Post</span>
<span class="nx">Bar</span> <span class="nf">postIt</span><span class="o">(</span><span class="nx">Foo</span> <span class="nx">payload</span><span class="o">,</span> <span class="nd">@Header</span> <span class="nx">String</span> <span class="nx">userAgent</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// User-Agent</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Get</span>
<span class="nx">Bazz</span> <span class="nf">find</span><span class="o">(</span><span class="nd">@Header</span> <span class="nx">String</span> <span class="nx">lastModified</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Last-Modified</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="cookie">@Cookie</h2>
<p>
  Use <code>@Cookie</code> for a Cookie parameter.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;bar/{name}&quot;</span><span class="o">)</span>
<span class="nx">Bar</span> <span class="nf">bar</span><span class="o">(</span><span class="nx">String</span> <span class="nx">name</span><span class="o">,</span> <span class="nd">@Cookie</span><span class="o">(</span><span class="s">&quot;my-cookie&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">myCookie</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;foo/{name}&quot;</span><span class="o">)</span>
<span class="nx">Foo</span> <span class="nf">foo</span><span class="o">(</span><span class="nx">String</span> <span class="nx">name</span><span class="o">,</span> <span class="nd">@Cookie</span> <span class="nx">String</span> <span class="nx">myCookie</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  The generated Helidon code for the method above is:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">_foo</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">path</span><span class="o">().</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">myCookie</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">cookies</span><span class="o">().</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;myCookie&quot;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
  <span class="n">res</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">controller</span><span class="o">.</span><span class="na">fooMe</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">myCookie</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="default">@Default</h3>
<p>
  We can use <code>@Default</code> to specify a default value for a Query Parameter/Header/Cookie/Form Parameter.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/catty&quot;</span><span class="o">)</span>
<span class="nx">List</span><span class="o">&lt;</span><span class="nx">Cat</span><span class="o">&gt;</span> <span class="nf">findCats</span><span class="o">(</span><span class="nd">@Header</span> <span class="nd">@Default</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">)</span> <span class="nx">String</span> <span class="nx">orderBy</span><span class="o">,</span> <span class="nd">@Default</span><span class="o">({</span><span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;2&quot;</span><span class="o">})</span> <span class="nx">List</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="o">&gt;</span> <span class="nx">numbersOfLimbs</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<h2 id="filter">@Filter</h2>
<p>
  Annotate methods with <code>@Filter</code> for HTTP filter web routes. Filter web routes behave similarly to void <code>@Get</code> methods (They can use header/query/cookie parameters with type conversion)
</p>
<h4>Helidon</h4>
<p>
  Helidon filters must have a <code>FilterChain</code> parameter, and optionally can add <code>RoutingRequest</code> and <code>RoutingResponse</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Filter</span>
<span class="kt">void</span> <span class="nf">filter</span><span class="o">(</span><span class="n">FilterChain</span> <span class="n">chain</span><span class="o">,</span> <span class="n">RoutingRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">RoutingResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//... filter logic</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Javalin</h4>
<p>
   Javalin filters correspond to <code>before</code> handlers, and we can add a <code>Context</code> parameter.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Filter</span>
<span class="kt">void</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//... filter logic</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="exceptions">@ExceptionHandler</h2>
 As the name implies, this annotation marks a handler method for handling exceptions that are thrown by other handlers.

 <p>Exception handler methods may have parameters of the following types:

 <ol>
   <li>An exception argument: declared as a general Exception or as a more specific exception.
       This also serves as a mapping hint if the annotation itself does not specify the exception
       types.
   <li>Request and/or response objects (typically from the microframework). We can choose any
       specific request/response type. e.g. Javalin's <code>Context</code> or Helidon's
       <code>ServerRequest</code>/<code>ServerResponse</code>.
 </ol>

 <p>Handler methods may be void or return an object for serialization. When returning an object, we can combine the <code>@ExceptionHandler</code> annotation with <code>@Produces</code> for a
 specific HTTP error status and media type.
</p>

<h4>Helidon</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@ExceptionHandler</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">501</span><span class="o">)</span>
<span class="n">Person</span> <span class="nf">exceptionCtx</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nx">IllegalStateException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">exceptionVoid</span><span class="o">(</span><span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//error logic</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Javalin</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@ExceptionHandler</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">501</span><span class="o">)</span>
<span class="n">Person</span> <span class="nf">exceptionCtx</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nx">IllegalStateException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">exceptionVoid</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//error logic</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="javalin-filter">(Javalin-only) @Before/@After</h2>
<p>
  For Javalin applications, we can use <code>@Before/@After</code> to mark a handler as a Javalin before/after handler.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Before</span><span class="o">(</span><span class="s">&quot;/path&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">before</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//... before logic</span>
<span class="o">}</span>

<span class="nd">@After</span><span class="o">(</span><span class="s">&quot;/path&quot;</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">after</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
 <span class="c1">//... after logic</span>
<span class="o">}</span>
</pre></div>
</div>
<h2 id="context">Context</h2>

<h3 id="javalin-context">Javalin Context</h3>
<p>
  The Javalin <code>Context</code> can be passed as a method argument or injected
  as a dependency of the controller.
</p>

<h4>Context as method argument</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span>
<span class="n">Response</span> <span class="nf">save</span><span class="o">(</span><span class="n">HelloDto</span> <span class="n">dto</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// use Javalin context as desired</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">202</span><span class="o">);</span>
  <span class="o">...</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Post</span>
<span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">HelloDto</span> <span class="n">dto</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// use Javalin context as desired</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>


<h3 id="helidon-request">Helidon request/response</h3>
<p>
  Helidon has <code>ServerRequest</code> and <code>ServerResponse</code> and these can
  be passed as a method argument of injected as a dependency of the controller.
</p>
<h4>ServerRequest/ServerResponse as method argument</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span>
<span class="n">Response</span> <span class="nf">save</span><span class="o">(</span><span class="n">HelloDto</span> <span class="n">dto</span><span class="o">,</span> <span class="n">ServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// use Helidon server request or response as desired</span>
  <span class="o">...</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="o">();</span>
<span class="o">}</span>
<span class="nd">@Post</span>
<span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">HelloDto</span> <span class="n">dto</span><span class="o">,</span> <span class="n">ServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// use Helidon server request or response as desired</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>


<h3>Controllers are singleton scoped by default</h3>
<p>
  By default controllers are singleton scoped. When we pass context objects like
  <em>Javalin Context</em> or <em>Helidon ServerRequest</em> as method arguments
  then the controllers remain singleton scoped.
</p>

<h3 id="request-scoped">Request scoped controllers</h3>
<p>
  We can define the Javalin context, Helidon ServerRequest
  or ServerResponse as a dependency to be injected using constructor injection
  or field injection (rather than passed as a method argument).
</p>
<p>
  <a href="/inject">avaje-inject</a> knows that these types need to be injected
  per request and automatically makes the controller request scoped.
</p>
<p>
  Request scoped means that a new instance of the controller will be instantiated
  for each request.
</p>

<h5>Example</h5>
<p>
  The following ContactController has the Javalin Context as a constructor injected
  dependency. The controller is request scoped and instantiated per request.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// Automatically becomes request scoped</span>
<span class="c1">//  ... because Javalin Context is a dependency</span>
<span class="c1">//  ... controller instantiated per request</span>

<span class="nd">@Controller</span><span class="o">(</span><span class="s">&quot;/contacts&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">ContactController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ContactService</span> <span class="n">contactService</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Context</span> <span class="n">context</span><span class="o">;</span> <span class="c1">// Javalin Context</span>

  <span class="c1">// Inject Javalin context via constructor</span>
  <span class="nd">@Inject</span>
  <span class="n">ContactController</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">ContactService</span> <span class="n">contactService</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">contactService</span> <span class="o">=</span> <span class="n">contactService</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Contact</span> <span class="nf">getById</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// use the javalin context ...</span>
    <span class="k">var</span> <span class="n">fooCookie</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">cookieStore</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<h5>Example</h5>
<p>
  In this example ProductController has the Helidon ServerRequest and ServerResponse
  injected using field injection rather than constructor injection.
  Note that when using field injection they can <em>not</em> be final and can <em>not</em> be private.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// Automatically becomes request scoped</span>
<span class="c1">//  ... because Helidon request and response are a dependency</span>
<span class="c1">//  ... controller instantiated per request</span>

<span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/products&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MyService</span> <span class="n">myService</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="n">ServerRequest</span> <span class="n">request</span><span class="o">;</span> <span class="c1">// Helidon request field injected</span>

  <span class="nd">@Inject</span>
  <span class="n">ServerRequest</span> <span class="n">response</span><span class="o">;</span> <span class="c1">// Helidon response field injected</span>

  <span class="nd">@Inject</span>
  <span class="n">ProductController</span><span class="o">(</span><span class="n">MyService</span> <span class="n">myService</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">myService</span> <span class="o">=</span> <span class="n">myService</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Contact</span> <span class="nf">getById</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// use the helidon request ...</span>
    <span class="k">var</span> <span class="n">fooCookie</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">cookies</span><span class="o">().</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<h3 id="instrument-context">Instrumenting the Server Context</h3>
<p>
  The <code>@InstrumentServerContext</code> annotation marks a controller method to be instrumented with <code>RequestContextResolver</code>. For the execution of the controller method, the server context will be stored by the given implementation of <code>RequestContextResolver</code>.
</p>

<p>
  By default, a <code>RequestContextResolver</code> implementation using ThreadLocals is provided to store the Context instance. When using virtual threads, it may be better to provide an implementation using Scoped Values.
</p>

<h4>Using RequestContextResolver</h4>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">RequestContextResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="o">...</span>

<span class="nd">@Get</span>
<span class="nd">@InstrumentServerContext</span>
<span class="kt">void</span> <span class="nf">helloWorld</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
 <span class="n">Context</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="na">currentRequest</span><span class="o">().</span><span class="na">orElseThrow</span><span class="o">().</span><span class="na">response</span><span class="o">()</span>
 <span class="n">ctx</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="s">&quot;success&quot;</span><span class="o">);</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<h2 id="type-conversions">Type conversions</h2>
<p>
  There are built in type conversions for the following types:
</p>
<ul>
  <li>int, long, boolean, Integer, Long, Boolean</li>
  <li>BigDecimal, UUID, LocalDate, LocalTime, LocalDateTime</li>
  <li>Enum Types via <em>valueOf</em> (will use toUpperCase on the query parameter)</li>
</ul>
<p>
 For multivalue parameters like query parameters or headers, we can use <code>List&ltT&gt</code> or <code>Set&ltT&gt</code> where <code>T</code> is any of the previously mentioned types.
</p>
<p>
  In the following example there is a type conversion for <em>startDate</em> and <em>active</em>.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}/{name}&quot;</span><span class="o">)</span>
<span class="n">Hello</span> <span class="nf">hello</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span>
       <span class="n">String</span> <span class="n">name</span><span class="o">,</span>
       <span class="n">LocalDate</span> <span class="n">startDate</span><span class="o">,</span>
       <span class="n">Boolean</span> <span class="n">active</span><span class="o">,</span>
       <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">longs</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  For example, the Javalin generated code below includes the type conversion
  with <code>toLocalDate()</code> and <code>toBoolean()</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;/hello/{id}/{name}&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">asInt</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">));</span>
  <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">pathParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">);</span>
  <span class="n">LocalDate</span> <span class="n">startDate</span> <span class="o">=</span> <span class="n">toLocalDate</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;startDate&quot;</span><span class="o">));</span>
  <span class="n">Boolean</span> <span class="n">active</span> <span class="o">=</span> <span class="n">toBoolean</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;active&quot;</span><span class="o">));</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">longs</span> <span class="o">=</span> <span class="n">list</span><span class="o">(</span><span class="n">PathTypeConversion</span><span class="o">::</span><span class="n">toLong</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">&quot;longs&quot;</span><span class="o">));</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="n">controller</span><span class="o">.</span><span class="na">hello</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">startDate</span><span class="o">,</span> <span class="n">active</span><span class="o">,</span> <span class="n">longs</span><span class="o">));</span>
<span class="o">});</span>
</pre></div>
</div>

<h3>Conversion Exception Handling</h3>
<p>
  If a parameter fails type conversion then <code>InvalidPathArgumentException</code> is thrown.
  This exception is typically mapped to a <code>404</code> response in the exception handler.
</p>
<p>
  Note that <code>path</code> conversions imply the value can NOT be null. All other parameter
  types are considered optional/nullable.
</p>
<p>
  <code>InvalidTypeArgumentException</code> is throw for non-path parameter conversions that
  fail such as conversions in form beans, query parameters, headers and cookies.
</p>
<p>
  We should register exception handlers for these 2 exceptions like the handlers below:
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">record</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">){};</span>

<span class="nd">@Produces</span><span class="o">(</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="o">)</span>
<span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nx">InvalidPathArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="n">ErrorResponse</span> <span class="nf">validException</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>

 <span class="k">return</span> <span class="k">new</span> <span class="n">ErrorResponse</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">path</span><span class="o">(),</span> <span class="s">&quot;invalid path argument&quot;</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Produces</span><span class="o">(</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="o">)</span>
<span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nx">InvalidTypeArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="n">ErrorResponse</span> <span class="nf">validException</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>

 <span class="k">return</span> <span class="k">new</span> <span class="n">ErrorResponse</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">path</span><span class="o">(),</span> <span class="s">&quot;invalid type argument&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="bean-validation">Bean validation</h2>
<p>
  We can optionally add bean validation through the validator interface. We can validate a request body and Form Bean/BeanParam
</p>
<p>
  Example: <a target="_blank" href="https://github.com/dinject/examples/blob/master/javalin-maven-java-basic/src/main/java/org/example/myapp/web/HelloController.java#L30">HelloController</a>
</p>

<h3>Add @Valid</h3>
<p>
  Add a jakarta/javax/avaje <code>@Valid</code> annotation on controllers/methods and the types that we want bean validation to
  be included for. When we do this, controller methods that take a request payload
  will then have the request bean (populated by JSON payload or form/header/query parameters)
  validated before it is passed to the controller method.
</p>
<p>
  The avaje-http <code>@Valid</code> annotation can additionally be used to set the Validation Groups to use while validating.
</p>
<p>
  For the controller method below:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Valid</span>
<span class="kd">class</span> <span class="nc">HelloForm</span> <span class="o">{</span>
  <span class="nd">@NotBlank</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
  <span class="c1">//getters/setters/constructors</span>
<span class="o">}</span>

<span class="nd">@Valid</span>
<span class="kd">class</span> <span class="nc">HelloBean</span> <span class="o">{</span>
  <span class="nd">@NotBlank</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="nd">@Email</span><span class="o">(</span><span class="nx">groups</span><span class="o">=</span><span class="nx">EmailCheck</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
  <span class="c1">//getters/setters/constructors</span>
<span class="o">}</span>

<span class="nd">@Valid</span>
<span class="kd">class</span> <span class="nc">BodyClass</span> <span class="o">{</span>
  <span class="nd">@NotBlank</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">somefield</span><span class="o">;</span>
  <span class="c1">//getters/setters/constructors</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Valid</span>
<span class="nd">@Controller</span><span class="o">(</span><span class="s">&quot;/baz&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">BazController</span>  <span class="o">{</span>

  <span class="nd">@Form</span>
  <span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;/form&quot;</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">saveForm</span><span class="o">(</span><span class="n">HelloForm</span> <span class="n">helloForm</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@io.avaje.http.api.Valid</span><span class="o">(</span><span class="nx">groups</span><span class="o">={</span><span class="nx">Default</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="nx">EmailCheck</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
  <span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;/bean&quot;</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">saveBean</span><span class="o">(</span><span class="nd">@BeanParam</span> <span class="nx">HelloBean</span> <span class="nx">helloBean</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;/body&quot;</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">saveBody</span><span class="o">(</span><span class="n">BodyClass</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
</pre></div>
</div>
<p>
  The generated code now includes validation of the beans before they are
  passed to the controller method. The generated code is:
</p>

<details>
    <summary>Helidon 4.x</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">String</span> <span class="nf">language</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">first</span><span class="o">(</span><span class="n">HEADER_ACCEPT_LANGUAGE</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">_saveForm</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">formParams</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">content</span><span class="o">().</span><span class="na">as</span><span class="o">(</span><span class="n">Parameters</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="k">var</span> <span class="n">helloForm</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">HelloForm</span><span class="o">(</span>
      <span class="n">formParams</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span>
      <span class="n">formParams</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
    <span class="o">);</span>

  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">helloForm</span><span class="o">,</span> <span class="n">language</span><span class="o">(</span><span class="n">req</span><span class="o">));</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveForm</span><span class="o">(</span><span class="n">helloForm</span><span class="o">,</span> <span class="n">res</span><span class="o">);</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">_saveBean</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">helloBean</span> <span class="o">=</span>  <span class="k">new</span> <span class="n">HelloBean</span><span class="o">(</span>
      <span class="n">req</span><span class="o">.</span><span class="na">query</span><span class="o">().</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span>
      <span class="n">req</span><span class="o">.</span><span class="na">query</span><span class="o">().</span><span class="na">first</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
    <span class="o">);</span>

  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">helloBean</span><span class="o">,</span> <span class="n">language</span><span class="o">(</span><span class="n">req</span><span class="o">),</span> <span class="n">Default</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">EmailCheck</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveBean</span><span class="o">(</span><span class="n">helloBean</span><span class="o">,</span> <span class="n">res</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">_saveBody</span><span class="o">(</span><span class="n">ServerRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServerResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="n">res</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">CREATED_201</span><span class="o">);</span>
  <span class="k">var</span> <span class="n">body</span> <span class="o">=</span> <span class="n">bodyClassJsonType</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">content</span><span class="o">().</span><span class="na">inputStream</span><span class="o">());</span>
  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">language</span><span class="o">(</span><span class="n">req</span><span class="o">));</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveBody</span><span class="o">(</span><span class="n">body</span><span class="o">,</span> <span class="n">res</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</details>

<details>
  <summary>Javalin</summary>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/baz/form&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">HelloForm</span> <span class="n">helloForm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HelloForm</span><span class="o">(</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">),</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">formParam</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="k">var</span> <span class="n">validLanguage</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept-Language&quot;</span><span class="o">);</span>
  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">helloForm</span><span class="o">,</span> <span class="n">validLanguage</span><span class="o">);</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveForm</span><span class="o">(</span><span class="n">helloForm</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/baz/bean&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="n">HelloBean</span> <span class="n">helloBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HelloBean</span><span class="o">(</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">),</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="k">var</span> <span class="n">validLanguage</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept-Language&quot;</span><span class="o">);</span>
  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">helloBean</span><span class="o">,</span> <span class="n">validLanguage</span><span class="o">,</span> <span class="n">Default</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">EmailCheck</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveBean</span><span class="o">(</span><span class="n">helloBean</span><span class="o">);</span>
<span class="o">});</span>

<span class="n">ApiBuilder</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;/baz/body&quot;</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">ctx</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
  <span class="k">var</span> <span class="n">body</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">bodyAsClass</span><span class="o">(</span><span class="n">BodyClass</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>       <span class="c1">// validation added here !!</span>
  <span class="n">controller</span><span class="o">.</span><span class="na">saveBody</span><span class="o">(</span><span class="n">helloBean</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>

</details>
<br>
<h4>Custom Validation</h4>
<p>
  For custom validation, you can can implement the avaje validator interface yourself and add custom logic.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.avaje.http.api.Validator</span><span class="o">;</span>

<span class="nd">@Singleton</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanValidator</span> <span class="kd">implements</span> <span class="n">Validator</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="n">String</span> <span class="n">acceptLanguage</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;...</span> <span class="n">groups</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">//do validation</span>
  <span class="c1">// if validation fails throw something</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Using Avaje Validation</h4>
<p>
  Add a dependency on <a target="_blank" href="https://avaje.io/validator/"><em>avaje-validator</em></a>. This will transitively
  bring in a <em>Validator</em> instance which will be used to validate beans.
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-validator<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>&#36;{validator.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>


<h4>Using Hibernate</h4>
<p>
  Add a dependency on <em>avaje-http-hibernate-validator</em>. This will provide a hibernate <em>Validator</em> instance which will be used to validate.
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-http-hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
  <span class="c">&lt;!-- use 2.9 for javax validation --&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>

<h3>ValidationException handler</h3>
<p>
  Add an exception handler for <code>ValidationException</code> like the one below.
  With bean validation we collect all the validation errors and these are included
  in the exception as a map keyed by the property path.
</p>
<p>
  <em>exception.getErrors()</em> in the handler below is returning a <code>Map&lt;String, Object&gt;</code>
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">record</span> <span class="nf">ErrorResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Violation</span><span class="o">&gt;</span> <span class="n">violations</span><span class="o">){};</span>

<span class="nd">@Produces</span><span class="o">(</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="o">)</span>
<span class="nd">@ExceptionHandler</span>
<span class="n">ErrorResponse</span> <span class="nf">validException</span><span class="o">(</span><span class="n">ValidationException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>

 <span class="k">return</span> <span class="k">new</span> <span class="n">ErrorResponse</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">ex</span><span class="o">.</span><span class="na">getErrors</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<h2 id="roles">Roles</h2>
<p>
  We can optionally add declarative security role checking for Javalin and Jex.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/customers&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">CustomerController</span>  <span class="o">{</span>

  <span class="nd">@Roles</span><span class="o">({</span><span class="nx">AppRoles</span><span class="o">.</span><span class="na">ADMIN</span><span class="o">,</span> <span class="nx">AppRoles</span><span class="o">.</span><span class="na">BASIC_USER</span><span class="o">})</span>
  <span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
  <span class="n">Customer</span> <span class="nf">find</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
</pre></div>
</div>

<h2 id="roles-javalin">Javalin Roles</h2>
<p>
  Example reference <a target="_blank" href="https://github.com/avaje/avaje-http/blob/master/tests/test-javalin/src/main/java/org/example/myapp/web/HelloController.java#L58">test-javalin - HelloController</a>
</p>
<h4>Step 1: Create an enum that implements io.javalin.security.RouteRole</h4>
<p>
  Create an enum that implements <code>io.javalin.security.RouteRole</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.javalin.security.RouteRole</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">AppRoles</span> <span class="kd">implements</span> <span class="n">RouteRole</span> <span class="o">{</span>
  <span class="n">ANYONE</span><span class="o">,</span> <span class="n">ADMIN</span><span class="o">,</span> <span class="n">BASIC_USER</span><span class="o">,</span> <span class="n">ORG_ADMIN</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Step 2: Create a Roles / PermittedRoles annotation</h4>
<p>
  Create an annotation that has a short name that ends with Roles or PermittedRoles.
  The annotation must follow this naming convention to be detected by the annotation
  processor (code generation).
</p>
<p>
  The annotation must have a <code>value()</code> attribute that specifies the
  enum role type specified in Step 1.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.example.myapp.web</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">java.lang.annotation.ElementType.METHOD</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">java.lang.annotation.ElementType.TYPE</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">java.lang.annotation.RetentionPolicy.RUNTIME</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Specify permitted roles.</span>
<span class="cm"> */</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nx">value</span><span class="o">={</span><span class="nx">METHOD</span><span class="o">,</span> <span class="nx">TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nx">value</span><span class="o">=</span><span class="nx">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nx">Roles</span> <span class="o">{</span>

  <span class="cm">/**</span>
<span class="cm">   * Specify the permitted roles.</span>
<span class="cm">   */</span>
  <span class="n">AppRoles</span><span class="o">[]</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Step 3: Use the annotation</h4>
<p>
  Add the annotation to any controller or controller methods as desired.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Roles</span><span class="o">({</span><span class="nx">AppRoles</span><span class="o">.</span><span class="na">ADMIN</span><span class="o">,</span> <span class="nx">AppRoles</span><span class="o">.</span><span class="na">BASIC_USER</span><span class="o">})</span>
<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
<span class="n">Customer</span> <span class="nf">find</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span>
</pre></div>
</div>

<h4>Step 4: Javalin AccessManager</h4>
<p>
  Ensure that Javalin is setup with an AccessManager to implement the role check.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="o">.</span><span class="na">accessManager</span><span class="o">((</span><span class="n">handler</span><span class="o">,</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">permittedRoles</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="c1">// implement role permission check</span>
    <span class="o">...</span>
  <span class="o">});</span>
<span class="o">});</span>
</pre></div>
</div>




<h2 id="roles-jex">Jex Roles</h2>
<p>
  Example reference <a target="_blank" href="https://github.com/avaje/avaje-http/blob/master/tests/test-jex/src/main/java/org/example/web/HelloController.java#L28">test-jex - HelloController</a>
</p>
<p>

</p>
<h4>Step 1: Create an enum that implements io.avaje.jex.Role</h4>
<p>
  Create an enum that implements <code>io.avaje.jex.Role</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io.avaje.jex.Role</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">AppRoles</span> <span class="kd">implements</span> <span class="n">Role</span> <span class="o">{</span>
  <span class="n">ANYONE</span><span class="o">,</span> <span class="n">ADMIN</span><span class="o">,</span> <span class="n">BASIC_USER</span><span class="o">,</span> <span class="n">ORG_ADMIN</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Step 2: Create a Roles / PermittedRoles annotation</h4>
<p>
  Create an annotation that has a short name that ends with Roles or PermittedRoles.
  The annotation must follow this naming convention to be detected by the annotation
  processor (code generation).
</p>
<p>
  The annotation must have a <code>value()</code> attribute that specifies the
  enum role type specified in Step 1.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.example.myapp.web</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">java.lang.annotation.ElementType.METHOD</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">java.lang.annotation.ElementType.TYPE</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">java.lang.annotation.RetentionPolicy.RUNTIME</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Specify permitted roles.</span>
<span class="cm"> */</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nx">value</span><span class="o">={</span><span class="nx">METHOD</span><span class="o">,</span> <span class="nx">TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nx">value</span><span class="o">=</span><span class="nx">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nx">Roles</span> <span class="o">{</span>

  <span class="cm">/**</span>
<span class="cm">   * Specify the permitted roles.</span>
<span class="cm">   */</span>
  <span class="n">AppRoles</span><span class="o">[]</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
<span class="o">}</span>
</pre></div>
</div>

<h4>Step 3: Use the annotation</h4>
<p>
  Add the annotation to controller methods or the controller as desired.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Roles</span><span class="o">({</span><span class="nx">AppRoles</span><span class="o">.</span><span class="na">ADMIN</span><span class="o">,</span> <span class="nx">AppRoles</span><span class="o">.</span><span class="na">BASIC_USER</span><span class="o">})</span>
<span class="nd">@Get</span><span class="o">(</span><span class="s">&quot;/{id}&quot;</span><span class="o">)</span>
<span class="n">Customer</span> <span class="nf">find</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span>
</pre></div>
</div>

<h4>Step 4: Jex AccessManager</h4>
<p>
  Ensure that Jex is setup with an AccessManager to implement the role check.
</p>

<h5>Example</h5>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">jex</span><span class="o">.</span><span class="na">accessManager</span><span class="o">((</span><span class="n">handler</span><span class="o">,</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">permittedRoles</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">})</span>
</pre></div>
</div>

<h2 id="openapi">OpenAPI</h2>
<p>
  An OpenAPI description of the API is always generated.
</p>
<p>
  The annotation processor that generates the web route adapters
  also generates a OpenAPI (swagger) definition of all the endpoints
  that the controllers define.
</p>
<p>
  Example <a target="_blank" href="https://github.com/avaje/avaje-http/blob/b4a3ccfdea89821456044bc142353f7aa88b69e1/tests/test-javalin-jsonb/src/main/java/org/example/myapp/web/test/OpenAPIController.java">Javalin OpenAPI Controller</a>.
  <br>
  Generated <a target="_blank" href="https://github.com/avaje/avaje-http/blob/b4a3ccfdea89821456044bc142353f7aa88b69e1/tests/test-javalin-jsonb/src/test/java/io/avaje/http/generator/expectedOpenApi.json">OpenAPI Definition</a>.
</p>

<h3 id=doc>Javadoc</h3>
<p>
  The annotation processor reads the javadoc (and Kotlin documentation) of the controller methods to generate the openAPI definition.
  The javadoc summary, description, @param and @return
  documentation are used to create the OpenAPI Operation definitions.
  <br>
  The processor reads all the request and response types as OpenAPI component schema. The various annotations like <code>@Header</code>,<code>@Param</code>, and <code>@Produces</code> also modify the generated OpenAPI docs.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Example of Open API Get (up to the first period is the operation summary).</span>
<span class="cm"> *</span>
<span class="cm"> * basic Post (This Javadoc description is added to the operation description)</span>
<span class="cm"> *</span>
<span class="cm"> * @param b the body (the param docs are used for query/header/body description)</span>
<span class="cm"> * @return funny phrase (this part of the javadoc is added to the response desc)</span>
<span class="cm"> */</span>
<span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;/post&quot;</span><span class="o">)</span>
<span class="n">ResponseModel</span> <span class="nf">endpoint</span><span class="o">(</span><span class="n">RequestModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
<span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<p>In Addition, the generator can read the request/response class javadoc to generate openAPI component description.</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">ResponseModel</span> <span class="o">{</span>
  <span class="cm">/** field one */</span>
  <span class="n">String</span> <span class="n">field1</span><span class="o">;</span>
  <span class="cm">/** field two */</span>
  <span class="n">String</span> <span class="n">field1</span><span class="o">;</span>
 <span class="o">}</span>
</pre></div>
</div>

<h4>@Consumes</h3>
<p>
  Adding the <code>@Consumes</code> annotation to a controller method let's you control what media type should be generated for the request body in the openAPI definition. This is useful when you are dealing with non-standard request content types.
</p>

<h4>@Deprecated</h3>
<p>
  Adding Javas's <code>@Deprecated</code> annotation to a controller method marks it as deprecated in the openAPI definition.
</p>

<h3 id=response>@OpenApiResponse</h3>

<p>
  This annotation lets you specify alternate endpoint response status codes/descriptions/types. This is useful for defining error scenarios, and when using the underlying Javalin/Helidon contructs in void methods.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@Post</span><span class="o">(</span><span class="s">&quot;/post&quot;</span><span class="o">)</span>
<span class="nd">@OpenAPIResponse</span><span class="o">(</span><span class="nx">responseCode</span> <span class="o">=</span> <span class="mi">200</span><span class="o">,</span> <span class="nx">description</span> <span class="o">=</span> <span class="s">&quot;overrides @return javadoc description&quot;</span><span class="o">)</span>
<span class="nd">@OpenAPIResponse</span><span class="o">(</span><span class="nx">responseCode</span> <span class="o">=</span> <span class="mi">201</span><span class="o">)</span> <span class="c1">// Will use @return javadoc description</span>
<span class="nd">@OpenAPIResponse</span><span class="o">(</span>
     <span class="n">responseCode</span> <span class="o">=</span> <span class="mi">404</span><span class="o">,</span>
     <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;User not found (Will not have an associated response schema)&quot;</span><span class="o">)</span>
<span class="nd">@OpenAPIResponse</span><span class="o">(</span>
     <span class="n">responseCode</span> <span class="o">=</span> <span class="mi">500</span><span class="o">,</span>
     <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;Some other Error (Will have this error class as the response class reference)&quot;</span><span class="o">,</span>
     <span class="n">type</span> <span class="o">=</span> <span class="n">ErrorResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="n">ResponseModel</span> <span class="nf">endpoint</span><span class="o">()</span> <span class="o">{}</span>
</pre></div>
</div>

<h3 id=validation>Validation Annotations - @NotNull, @Size, @Email etc</h3>
<p>
  The javax bean validation annotations <code>@NotNull</code>, <code>@Size</code>
  and <code>@Email</code> are read as well as detecting Kotlin non-nullable
  types as required properties.
</p>
<p>
  These are used to specify required properties, min max lengths and property format.
</p>

<h3 id=swag>Swagger annotations</h3>
<p>
  We can add a dependency on <code>io.swagger.core.v3:swagger-annotations:2.0.8</code>
  and add swagger annotations.
</p>

<h4>@OpenAPIDefinition</h4>
<p>
  We use <em>@OpenAPIDefinition</em> to define a title and description for the api.
  This annotation would often go on the Main method class or on package-info.java
  in the controllers package.
</p>
<p>
  Example <a target="_blank" href="https://github.com/dinject/examples/blob/master/javalin-maven-java-basic/src/main/java/org/example/myapp/Main.java#L18">@OpenAPIDefinition</a>
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@OpenAPIDefinition</span><span class="o">(</span>
  <span class="nx">info</span> <span class="o">=</span> <span class="nd">@Info</span><span class="o">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Example service&quot;</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;Example Javalin controllers with Java and Maven&quot;</span><span class="o">))</span>
</pre></div>
</div>
<h4>@Hidden</h4>
<p>
  Put <code>@Hidden</code> on controller methods that we want to exclude
  from the OpenAPI documentation.
</p>

<h4>@Tags</h4>
<p>
  Put <code>@Tags</code> on controller methods to add tags to the OpenAPI Operation documentation.
</p>

<h4>@SecurityScheme and @SecurityRequirement</h4>

<p>
  Put <code>@SecurityScheme or @SecurityRequirement</code> on controller methods to add to the OpenAPI Operation documentation.
</p>

<h3>Gradle plugin</h3>
<p>
  The gradle plugin by default puts the generated openapi.json file into
  <em>src/main/resource/public</em>
</p>
<p>
  To add the plugin:
</p>
<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">id</span><span class="o">(</span><span class="s1">&#39;io.avaje.openapi&#39;</span><span class="o">)</span> <span class="n">version</span><span class="o">(</span><span class="s1">&#39;1.0&#39;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
  To configure the openapi.json file to go to another location add a
  <em>openapi</em> configuration section in build.gradle like:
</p>
<div class="syntax groovy"><div class="highlight"><pre><span></span><span class="n">openapi</span> <span class="o">{</span>
  <span class="n">destination</span> <span class="o">=</span> <span class="s1">&#39;other/my-api.json&#39;</span>
<span class="o">}</span>
</pre></div>
</div>


<h3 id=plug>Maven Plugin</h3>
<p>
  The maven plugin by default puts the generated openapi.json file into
  <em>src/main/resource/public</em>
</p>
<p>
  To add the plugin into <em>build / plugins</em> section:
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>openapi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>main<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;phase&gt;</span>process-classes<span class="nt">&lt;/phase&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>openapi<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
<p>
  To configure the openapi.json file to go to another location add a
  <em>configuration section</em> element like:
</p>
<div class="syntax xml"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>openapi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;destination&gt;</span>other/my-api.json<span class="nt">&lt;/destination&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>main<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;phase&gt;</span>process-classes<span class="nt">&lt;/phase&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>openapi<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>

<h3 id=serve>Serving openapi.json</h3>
<p>
  When the openapi.json file is in src/main/resources/public it can be served by
  using <code>addStaticFiles</code> on the JavalinConfig like:
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">Javalin</span> <span class="n">app</span> <span class="o">=</span> <span class="n">Javalin</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="o">.</span><span class="na">addStaticFiles</span><span class="o">(</span><span class="s">&quot;public&quot;</span><span class="o">,</span> <span class="n">Location</span><span class="o">.</span><span class="na">CLASSPATH</span><span class="o">);</span>
<span class="o">});</span>
</pre></div>
</div>


<h2 id="jaxrs">JAX-RS</h2>
<p>
  Why not use the standard JAX-RS annotations?
</p>
<ul>
  <li>The JAX-RS API dependency also has a LOT of other stuff we don't want</li>
  <li>We can improve on JAX-RS making our controllers <b>less verbose</b></li>
</ul>

<p>&nbsp;</p>

<table class="table table-striped">
  <thead>
    <tr>
      <th><h4>avaje http</h4></th>
      <th><h4>JAX-RS</h4></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@Controller</td>
      <td>-</td>
    </tr>
    <tr>
      <td>@Path</td>
      <td>@Path</td>
    </tr>

    <tr>
      <th colspan="2" class="heading"><h4>HTTP Methods</h4></th>
    </tr>

    <tr>
      <td>@Delete</td>
      <td>@DELETE + @Path</td>
    </tr>
    <tr>
      <td>@Get</td>
      <td>@GET + @Path</td>
    </tr>
    <tr>
      <td>@Post</td>
      <td>@POST + @Path</td>
    </tr>
    <tr>
      <td>@Put</td>
      <td>@PUT + @Path</td>
    </tr>
    <tr>
      <td>@Patch</td>
      <td>@PATCH + @Path</td>
    </tr>

    <tr>
      <th colspan="2" class="heading"><h4>Bean parameters</h4></th>
    </tr>

    <tr>
      <td>@Form</td>
      <td>-</td>
    </tr>

    <tr>
      <td>@BeanParam</td>
      <td>@BeanParam</td>
    </tr>

    <tr>
      <td colspan="2"><h4>Parameters</h4></td>
    </tr>

    <tr>
      <td>Not needed (implied)</td>
      <td>@PathParam</td>
    </tr>
    <tr>
      <td>Not needed (implied)</td>
      <td>@MatrixParam</td>
    </tr>

    <tr>
      <td>@FormParam + @Default</td>
      <td>@FormParam + @DefaultValue</td>
    </tr>
    <tr>
      <td>@QueryParam + @Default</td>
      <td>@QueryParam + @DefaultValue</td>
    </tr>

    <tr>
      <td>@Header</td>
      <td>@HeaderParam</td>
    </tr>

    <tr>
      <td>@Cookie</td>
      <td>@CookieParam</td>
    </tr>

  </tbody>
</table>



  </article>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="/js/site.js"></script>
</body>
</html>
