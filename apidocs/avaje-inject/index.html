<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Tue Mar 22 17:35:48 NZDT 2022 -->
<title>Overview (avaje inject 8.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2022-03-22">
<meta name="description" content="module index">
<meta name="generator" content="javadoc/ModuleIndexWriter">
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="script.js"></script>
<script type="text/javascript" src="script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="script-dir/jquery-ui.min.js"></script>
</head>
<body class="module-index-page">
<script type="text/javascript">var pathtoroot = "./";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li class="nav-bar-cell1-rev">Overview</li>
<li><a href="io.avaje.inject/module-summary.html">Module</a></li>
<li>Package</li>
<li>Class</li>
<li>Use</li>
<li><a href="overview-tree.html">Tree</a></li>
<li><a href="index-all.html">Index</a></li>
<li><a href="help-doc.html#overview">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<h1 class="title">avaje inject 8.0 API</h1>
</div>
<div class="block"><h2>Overview</h2>
<p>
  Annotate classes with <code>@Singleton</code> / <code>@Factory</code> and <em>avaje-inject</em>
  will generate source code to "wire them".
</p>

<h4>1. @Singleton / @Factory</h4>
<p>
  Put <code>@Singleton</code> on beans that we want avaje-inject to wire.
<p>
  We can use <code>@Factory/@Bean</code> to programmatically create dependencies
  when they have interesting construction logic (e.g. construction depends on
  system/environment properties etc - like Spring @Configuration).

<pre><code>

    @Singleton
    public class CoffeeMaker { ... }

    @Singleton
    public class Pump { ... }

    // Use @Factory to programmatically build dependencies

    @Factory
    public class MyFactory {

      @Bean
      Grinder buildGrinder(Pump pump) { // interesting construction logic ... }

    }

  </code></pre>

<h4>2. Create and use BeanScope</h4>
<p>
  Create <a href="io.avaje.inject/io/avaje/inject/BeanScope.html" title="interface in io.avaje.inject"><code>BeanScope</code></a> using a builder.
  Obtain beans from the scope and use them.
<p>
  We should ensure the BeanScope is closed in order to fire
  preDestroy lifecycle methods. We can do this via a shutdown
  hook, or try with resource block or explicitly via application code.

<pre><code>

    // create BeanScope
    BeanScope scope = BeanScope.newBuilder()
      .build();

    // use it
    CoffeeMaker coffeeMaker = scope.get(CoffeeMaker.class);
    coffeeMaker.makeIt();

    // close it to fire preDestroy lifecycle methods
    scope.close();

  </code></pre>

<h2>Default scope</h2>
<p>
  All beans annotated with <code>@Singleton</code> and <code>@Factory</code> are by default included in
  the "default scope".
<p>
  When we create a BeanScope and do not specify any modules then all the beans in the default
  scope are included. This is done via ServiceLoader and includes all 'default scope' modules
  that are in the classpath (other jars can have default scope modules and these are all included).

<h4>Generated code</h4>
<p>
  <em>avaje-inject</em> will generate a <code>$DI</code> class for each bean that it is going to
  wire - this has the code that instantiates the bean, performs field and method injection and
  lifecycle support (PostConstruct and PreDestroy).
<p>
  <em>avaje-inject</em> will generate a Module class for the default scope. The main job of
  the module code is to specify the ordering of how all the beans are instantiated.
<p>
  We typically find the generated source code in <em>target/generate-sources/annotations</em>.


<h2>Custom scopes</h2>
<p>
  We can create custom scopes that only contain the beans/components that we want to include in
  that scope. These beans/components in the custom scope are not included in the default scope.
<p>
  To do this we:

<h4>1. Create the scope annotation</h4>
<p>
  Create an annotation that has the <code>Scope</code> annotation. In the example below we create the
  <code>@StoreComponent</code> annotation. We will put this annotation on beans that we want
  included in the scope.

<pre><code>

     @Scope
     public @interface StoreComponent {
     }

  </code></pre>

<p>
  Note that if this scope depends on external dependencies or another scope we specify that via
  <code>@InjectModule requires</code>. In the example below our StoreComponent depends on another
  scope called QueueComponent and an external dependency - SomeExternalDependency.

<pre><code>

     @Scope
     @InjectModule(requires = {QueueComponent.class, SomeExternalDependency.class})
     public @interface StoreComponent {
     }

  </code></pre>

<h4>2. Use the annotation</h4>
<p>
  Put the <code>@StoreComponent</code> annotation on the beans that we want included in the
  custom scope.

<pre><code>

    @StoreComponent
    public class StoreLoader {
      ...
    }

  </code></pre>


<h4>3. Generated Module</h4>
<p>
  <em>avaje-inject</em> will generate a <code>StoreComponentModule</code> with the appropriate
  code to create/wire all the beans in the custom scope.
<p>
  StoreComponentModule is typically found in <em>target/generate-sources/annotations</em>.
  For each component we will also see a <code>$DI</code> class which is the generated code
  that creates the component.

<h4>4. Use the custom scope</h4>
<p>
  To use the custom scope we specify the <code>StoreComponentModule</code> when creating the
  BeanScope. Only the components in our module will be create/wired into the BeanScope.
<p>
  If the scope depends on another scope then we specify that using <code>withParent()</code>.

<pre><code>

    BeanScope parentScope = ...

    BeanScope scope = BeanScope.newBuilder()
      .withModules(new StoreComponentModule())
      .withParent(parentScope)
      .build());

    StoreLoader storeLoader = scope.get(StoreLoader.class);
    storeLoader.load();

  </code></pre></div>
<div id="all-modules-table">
<div class="caption"><span>Modules</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Module</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color all-modules-table all-modules-table-tab1"><a href="io.avaje.inject/module-summary.html">io.avaje.inject</a></div>
<div class="col-last even-row-color all-modules-table all-modules-table-tab1">&nbsp;</div>
</div>
</div>
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2022. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
